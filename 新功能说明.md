# 智能目标管理系统 - 新功能说明

## 🎉 新增功能概览

本次更新为智能目标管理系统添加了强大的目标分解、七日日程规划和日历导出功能，帮助您将长期目标逐步落实到每天的具体行动。

---

## ✨ 主要新功能

### 1. 📊 多层级目标分解（月度→周→天）

#### 功能描述
- **月度目标分解为周任务**：AI 智能将月度目标拆解为 4-5 个周任务
- **周任务分解为日任务**：进一步将周任务细化为每天的具体行动
- **智能日期建议**：自动为每个子任务设定合理的截止日期和优先级
- **完整目标层级**：长期 → 年度 → 季度 → 月度 → 周 → 天

#### 使用方法
1. 在"🎯 目标"页面创建或查看目标
2. 点击目标卡片上的 "🧠" 按钮（现在支持月度和周目标）
3. AI 会自动分析目标并生成子任务
4. 查看分析结果，选择需要添加的子任务
5. 周类型任务会自动添加到周任务列表中

#### AI 分解示例
**月度目标**："完成项目文档编写"
- 周任务 1：完成需求分析文档（第1周）
- 周任务 2：编写技术设计文档（第2周）
- 周任务 3：撰写用户手册（第3周）
- 周任务 4：审核和修订所有文档（第4周）

**周任务**："完成需求分析文档"
- 周一：收集和整理需求信息
- 周二：绘制业务流程图
- 周三：编写功能需求列表
- 周四：完成非功能需求
- 周五：文档审阅和修订

---

### 2. 📅 七日智能日程规划

#### 功能描述
- **自动筛选近七日任务**：智能识别未来 7 天内的周任务和日常任务
- **智能时间分配**：根据任务优先级、预计时长和日常活动自动排列时间
- **避免时间冲突**：自动避开固定活动时间，合理安排任务间隔
- **可视化七日视图**：清晰展示每天的详细安排

#### 使用方法
1. 在侧边栏点击 "📅 生成七日日程" 或在日程页面点击生成按钮
2. 系统自动整合：
   - 未来 7 天的周任务
   - 已设定日期的普通任务
   - 日常固定活动（吃饭、运动、睡觉等）
3. 查看"📅 七日日程"标签页，浏览每天的详细安排
4. 每天的安排包括：
   - 开始时间和结束时间
   - 任务/活动名称
   - 预计时长
   - 优先级标识

#### 日程生成逻辑
1. 按日期分组所有任务（周任务 + 普通任务）
2. 按优先级排序任务（高→中→低）
3. 在日常活动间隙智能插入任务
4. 优先安排高优先级任务
5. 确保每个任务有足够的执行时间

---

### 3. 📥 macOS 日历导出功能

#### 功能描述
- **iCalendar 格式导出**：生成标准 .ics 文件
- **完整信息导出**：包含任务名称、时间、优先级、准备事项等
- **一键导入**：双击文件即可导入到 macOS 日历
- **跨平台兼容**：支持所有主流日历应用

#### 使用方法
1. 在"📅 日程"页面的"七日日程"标签
2. 点击 "📥 导出到日历" 按钮
3. 下载生成的 .ics 文件
4. 双击文件自动导入到 macOS 日历
5. 也可手动导入到其他日历应用

#### 支持的日历应用
- ✅ macOS 日历（推荐）
- ✅ Google Calendar
- ✅ Microsoft Outlook
- ✅ iCloud 日历
- ✅ 任何支持 iCalendar 格式的应用

#### 导出内容包括
- **任务事件**：
  - 🎯 任务名称
  - ⏰ 开始和结束时间
  - 📊 优先级（🔴高 / 🟡中 / 🟢低）
  - 📋 准备事项
  - 💡 工作指导
  
- **活动事件**：
  - ⏰ 活动名称
  - ⏰ 固定时间安排
  - 🔄 重复设置（如需要）

---

### 4. 📋 周任务管理

#### 功能描述
- **独立的周任务列表**：专门存储周级别的任务
- **自动日期关联**：周任务自动关联到具体日期
- **智能提醒**：展示近七日内的周任务
- **进度追踪**：标记任务完成状态

#### 新增数据结构
```javascript
weekly_tasks = [
  {
    id: timestamp,
    name: "任务名称",
    goalId: "关联的目标ID",
    category: "分类",
    description: "详细描述",
    priority: 1-3,  // 1=低, 2=中, 3=高
    estimatedTime: 60,  // 预计时长（分钟）
    scheduledDate: "2025-10-05",  // 计划日期
    completed: false,
    createdAt: "ISO日期时间"
  }
]
```

---

## 🎯 使用场景示例

### 场景 1：长期健康目标落地
1. **长期目标**："保持健康的生活方式"
2. **年度目标**："减重 10 公斤"
3. **季度目标**："Q4 减重 3 公斤"
4. **月度目标**："10 月减重 1 公斤"
5. **周任务**：
   - 每周运动 4 次（周一、三、五、日）
   - 每周准备健康餐 5 天
6. **日任务**：
   - 周一：晨跑 30 分钟 + 准备一周沙拉
   - 周二：准备健康晚餐
   - 周三：力量训练 40 分钟
   - ...

### 场景 2：项目管理
1. **月度目标**："完成新产品开发"
2. **周任务分解**：
   - 第1周：需求分析和原型设计
   - 第2周：核心功能开发
   - 第3周：测试和优化
   - 第4周：上线准备
3. **日程安排**：
   - AI 自动在工作时间内分配任务
   - 避开会议和固定活动时间
   - 根据优先级合理排序

---

## 🚀 快速开始

### 步骤 1：设置 AI 配置（推荐）
1. 进入"⚙️ 设置"页面
2. 启用"AI 智能分析"
3. 选择 AI 提供商（Claude/ChatGPT/通义千问/DeepSeek）
4. 输入 API Key
5. 测试连接

### 步骤 2：创建目标层级
1. 创建一个月度目标
2. 使用 AI 分解为周任务
3. 必要时进一步分解周任务为日任务

### 步骤 3：设置日常活动
1. 在"📅 日程"页面的"日常活动"标签
2. 添加固定活动（如吃饭、运动、睡觉）
3. 设置活动时间和时长

### 步骤 4：生成智能日程
1. 点击"📅 生成七日日程"
2. 查看自动生成的详细安排
3. 导出到日历应用

---

## 💡 使用技巧

### 技巧 1：合理设置任务时间
- 为任务设定实际可完成的时长
- 预留缓冲时间应对突发情况
- 高优先级任务分配更多时间

### 技巧 2：充分利用 AI 分解
- 目标描述越详细，AI 分解越准确
- 设定明确的截止日期
- 在关键行动中包含具体步骤

### 技巧 3：定期审查和调整
- 每周查看七日日程
- 及时调整未完成的任务
- 更新目标进度

### 技巧 4：日历集成最佳实践
- 每周导出一次日程到日历
- 在日历中设置提醒
- 利用日历的跨设备同步功能

---

## 📊 数据结构更新

### 新增字段

#### session_state 新增：
- `weekly_tasks`: 周任务列表
- `weekly_schedule`: 七日日程字典

#### task 对象新增：
- `scheduledDate`: 计划执行日期（ISO 格式）

### 数据持久化
所有新数据自动保存到 `goal_planner_data.json`，包括：
- 周任务列表
- 七日日程安排
- 支持导入/导出

---

## 🔧 技术实现

### 核心函数

1. **`get_weekly_tasks_for_next_7_days()`**
   - 筛选未来 7 天的周任务
   - 按日期排序返回

2. **`generate_weekly_schedule()`**
   - 为未来 7 天生成日程
   - 整合周任务和普通任务
   - 智能分配时间段

3. **`export_to_icalendar(schedule_dict)`**
   - 转换日程为 iCalendar 格式
   - 生成 .ics 文件内容
   - 包含完整事件信息

4. **`ai_goal_breakdown(goal)`**（增强）
   - 支持月度→周、周→天的分解
   - 自动设置日期和优先级
   - 返回结构化的子任务

---

## 📝 注意事项

1. **AI 功能需要配置**：
   - 必须启用 AI API 才能使用目标分解
   - 需要有效的 API Key

2. **时间冲突处理**：
   - 日程生成会自动避开固定活动
   - 建议设置合理的任务时长

3. **日历导出**：
   - 需要先生成七日日程
   - .ics 文件可重复导出
   - 建议每周更新一次

4. **数据备份**：
   - 定期导出数据备份
   - 周任务数据包含在备份中

---

## 🆕 版本信息

**版本**：v1.1  
**更新日期**：2025-10-02  
**新增功能**：
- ✅ 月度/周目标分解到天任务
- ✅ 七日智能日程规划
- ✅ 近七日周任务自动筛选
- ✅ iCalendar 格式导出
- ✅ macOS 日历集成

**兼容性**：
- 完全向后兼容 v1.0
- 自动迁移旧数据
- 新增字段可选

---

## 🎓 最佳实践

### 1. 目标设定
- 使用 SMART 原则（具体、可衡量、可实现、相关、有时限）
- 月度目标不超过 3-5 个
- 每周任务保持在 5-7 个

### 2. 时间管理
- 高优先级任务安排在精力最好的时段
- 预留 20-30% 缓冲时间
- 固定活动优先安排

### 3. 执行跟踪
- 每天查看当日日程
- 及时标记完成的任务
- 每周回顾调整下周计划

### 4. AI 辅助
- 目标描述清晰详细
- 提供足够的背景信息
- 审核 AI 建议并调整

---

## 🔗 相关文档

- [快速使用指南.md](快速使用指南.md)
- [项目结构.md](项目结构.md)
- [README.md](README.md)

---

## 📞 支持与反馈

如有问题或建议，请：
1. 查看快速使用指南
2. 检查设置配置
3. 导出数据备份后重试

祝您高效管理目标，逐步实现梦想！ 🎯✨
